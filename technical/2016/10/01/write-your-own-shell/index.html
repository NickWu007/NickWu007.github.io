<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v7.5.1 <https://qwtel.com/hydejack/>
--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>Write your own shell | DevPractical</title><meta property="og:title" content="Write your own shell" /><meta name="author" content="nickwu0715" /><meta property="og:locale" content="en" /><meta name="description" content="Write your own shell" /><meta property="og:description" content="Write your own shell" /><link rel="canonical" href="https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/" /><meta property="og:url" content="https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/" /><meta property="og:site_name" content="DevPractical" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-10-01T03:33:34+01:00" /> <script type="application/ld+json"> {"name":null,"description":"Write your own shell","author":{"@type":"Person","name":"nickwu0715"},"@type":"BlogPosting","url":"https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://nickwu007.github.io/assets/icons/icon.png"},"name":"nickwu0715"},"image":null,"headline":"Write your own shell","dateModified":"2016-10-01T03:33:34+01:00","datePublished":"2016-10-01T03:33:34+01:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/"},"@context":"http://schema.org"}</script><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="DevPractical"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="application-name" content="DevPractical"><meta name="msapplication-config" content="/assets/ieconfig.xml"><meta name="theme-color" content="#48ea4e"><meta name="generator" content="Hydejack v7.5.1"><link type="application/atom+xml" rel="alternate" href="https://nickwu007.github.io/feed.xml" title="DevPractical" /><link rel="alternate" href="https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/" hreflang="en"><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon.png"><link rel="manifest" href="/assets/manifest.json"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link id="_disqusJS" rel="dns-prefetch" href="https://{"shortname"=>"devpractical"}.disqus.com/embed.js"><link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"><link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <script> function stdOnEnd(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function ieOnEnd(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}window.setRelStylesheet=function(n){function e(){this.rel="stylesheet"}var o=document.getElementById(n);o.addEventListener?o.addEventListener("load",e,!1):o.onload=e},window._loaded=!1,window.loadJSDeferred=function(n,e){function o(){window._loaded=!0;var o=document.createElement("script");o.src=n,e&&(("onload"in o?stdOnEnd:ieOnEnd)(o,e),o.onload||stdOnEnd(o,e));var t=document.scripts[0];t.parentNode.insertBefore(o,t)}window._loaded?o():window.addEventListener?window.addEventListener("load",o,!1):window.onload=o}; !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window._noPushState = false; window._noDrawer = false; </script> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: ['Roboto+Slab:700','Noto+Sans:400,400i,700,700i'] }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; (function(d) { var wf = d.createElement('script'), s = d.scripts[0]; wf.src = "/assets/bower_components/webfontloader/webfontloader.js"; s.parentNode.insertBefore(wf, s); }(document)); </script> <!--<![endif]--> <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i"><style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif }</style><link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--[if gt IE 8]><!----><style> *{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:#444;background-color:#fff;overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}.content img,.img{display:block;max-width:100%;margin-bottom:1rem;border:none}.content img.lead,.img.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{font-weight:700;margin:4rem 0 1rem}.heading{font-weight:700}h1,.h1{font-size:2rem;line-height:1.3}h2,.h2{font-size:1.5rem;line-height:1.4}h3,.h3{font-size:1.17em;line-height:1.5}p{margin-top:0;margin-bottom:1rem}p.lead{padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee}strong{font-weight:700}.hr{border-bottom:1px solid #eee;padding-bottom:1rem;margin-bottom:2rem}h4,h5,h6,.h4,.h5,.h6{margin-bottom:0.5rem;font-size:1rem}table:not(.highlight){border-collapse:collapse;margin-bottom:2rem;margin-left:-1rem}table:not(.highlight) td,table:not(.highlight) th{padding:.25rem .5rem;border:1px solid #eee}table:not(.highlight) td:first-child,table:not(.highlight) th:first-child{padding-left:1rem}table:not(.highlight) td:last-child,table:not(.highlight) th:last-child{padding-right:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#888}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message{margin-bottom:1rem;padding:1rem;color:#666;background-color:rgba(0,0,0,0.025);margin-left:-1rem;margin-right:-1rem}@media screen{body::before{content:'';width:.5rem;background:#eee;position:absolute;left:0;top:0;bottom:0}}@media screen and (min-width: 42em){html{font-size:17px}}@media screen and (min-width: 125em){html{font-size:18px}}hy-push-state a,.a{position:relative;padding-bottom:.15rem;border-bottom:1px solid}.content .img{overflow:hidden;background-color:rgba(0,0,0,0.025)}.content .img img{margin:0;width:100%;height:100%}.fade-in{animation-duration:500ms;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-3rem);opacity:0}50%{transform:translateY(-3rem);opacity:0}to{transform:translateY(0);opacity:1}}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.clearfix,.sidebar-social::after,.clearafter::after{content:"";display:table;clear:both}.sr-only{display:none}.sidebar{color:rgba(255,255,255,0.75);text-align:left}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}hy-drawer{position:relative;padding:1rem 0}@media screen{hy-drawer{padding:2rem 1rem}}@media screen and (min-width: 64em){hy-drawer{position:fixed;top:0;left:0;bottom:0;width:18rem;margin-left:0}}@media screen and (min-width: 98.5em){hy-drawer{width:calc(50% - 28rem)}}.sidebar-bg{position:absolute;top:0;right:0;bottom:0;left:0;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 100%)}.sidebar-sticky{position:relative;z-index:3}@media screen{.sidebar-sticky{position:absolute;right:1.5rem;left:1.5rem;bottom:1rem}}@media screen and (min-width: 98.5em){.sidebar-sticky{left:auto;width:15rem}}.sidebar-about>h1{color:#fff;font-size:2rem}.sidebar-nav>ul{list-style:none;padding-left:0;margin-bottom:.5rem}a.sidebar-nav-item{display:block;font-weight:700;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}.sidebar-social{margin-bottom:.5rem}.sidebar-social>ul{list-style:none;padding-left:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.5rem;width:3rem;height:3.5rem;padding:0}.sidebar-social>ul li+li{margin-top:0}.fixed-top{position:fixed;top:0;left:0;width:100%;z-index:2}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;height:0;color:#888}.nav-btn-bar{margin-left:-.875rem}.nav-btn{display:inline-block;padding:1.75rem .875rem;border-bottom:none;color:#888 !important}@media screen and (min-width: 64em){#_menu{position:absolute;left:-9999px}}.content{position:relative;margin-left:auto;margin-right:auto;padding:5rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;max-width:38rem;min-height:100vh}}@media screen and (min-width: 54em){.content{max-width:42rem}}@media screen and (min-width: 64em){.content{margin-left:22rem;margin-right:4rem;padding-left:1rem}}@media screen and (min-width: 90em){.content{max-width:48rem}}@media screen and (min-width: 98.5em){.content{margin:auto}}.avatar{float:right;width:6.5rem;height:6.5rem;border-radius:100%;margin-left:.5rem}@media screen and (min-width: 42em){.avatar{width:7rem;height:7rem}}html{font-family:Helvetica, Arial, sans-serif}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:Helvetica, Arial, sans-serif}</style><link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack-7.5.1.css"> <script>window.setRelStylesheet('_stylePreload');</script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-7.5.1.css"></noscript><style id="_pageStyle"> .content a:not(.btn){color:#48ea4e;border-color:rgba(72,234,78,0.2)}.content a:not(.btn):hover{border-color:#48ea4e}:focus{outline-color:#48ea4e}.btn-primary{color:#fff;background-color:#48ea4e;border-color:#48ea4e}.btn-primary:focus,.btn-primary.focus{box-shadow:0 0 0 3px rgba(72,234,78,0.5)}.btn-primary:hover,.btn-primary.hover{color:#fff;background-color:#26e62d;border-color:#26e62d}.btn-primary:disabled,.btn-primary.disabled{color:#fff;background-color:#48ea4e;border-color:#48ea4e}.btn-primary:active,.btn-primary.active{color:#fff;background-color:#26e62d;border-color:#26e62d}::selection{color:#fff;background:#48ea4e}::-moz-selection{color:#fff;background:#48ea4e}</style><!--<![endif]--><body><div class="navbar fixed-top"><div class="content"><div class="nav-btn-bar"> <span class="sr-only">Jump to:</span> <a id="_menu" class="nav-btn no-hover" href="#_navigation"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a></div></div></div><hy-push-state><main id="_main" class="content fade-in layout-post" role="main" data-color="#48ea4e" data-theme-color="" data-image="/assets/images/sidebar.jpg" data-overlay ><article id="post-technical-2016-10-01-write-your-own-shell" class="page post" role="article"><header><h1 class="post-title"> Write your own shell</h1><p class="post-date heading"> <time datetime="2016-10-01T03:33:34+01:00">01 Oct 2016</time> in <a href="/category/technical/" class="flip-title">Technical</a><div class="hr pb0"></div></header><h3 id="my-story">My story</h3><p>If you have been on the site often enough, you will know most of my programming is done on some high level abstraction language, or based on some frameworks. In the last few weeks, one of my university project is going way down on the abstraction spectrum, and try to build a shell in C. It took me a fair amount of banging on the wall and desperation, but since I did made something in the end, I want to write a post and talk about how to write your own shell.<h3 id="why-should-i-care">“Why should I care?”</h3><p>Some of you may say: I am not a system programmer, then why should I read any of this. For starter, if you are working in a software company, chances are you are using a unix OS, like Ubuntu. In a unix OS, the shell is arguably one of the most important tool at your disposal. Understanding the magic behind the shell would help you a lot when you want to debug some shell script, and during the process, you might realise that you can boost your productivity tremendously just by changing the way you use your shell.<p>So without further ado, let’s get into it!<h3 id="basic-components">Basic components</h3><p>Think about the bash shell you sue all the time. What does it consists of?<ul><li><p>An line waiting for input<li><p>Some logic to parse and execute the input and possibly produce some output<li><p>back to waiting input</ul><p>So it is pretty clear what the basic components are:<ul><li><p>A parser for input command<li><p>A executor for the command<li><p>A outer loop to keep getting inputs</ul><p>In the end, we should be able to put up something like this.<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">cmd_line</span> <span class="o">=</span> <span class="n">readLine</span><span class="p">();</span> <span class="c1">// reading the line
</span><span class="kt">char</span> <span class="o">**</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">parseInput</span><span class="p">(</span><span class="n">cmd_line</span><span class="p">);</span> <span class="c1">// parsing
</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="c1">// execution
</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Let’s look at each part individually.<h3 id="reading-the-line">Reading the line</h3><p>In C, the easiest way to do this is just <a href="http://man7.org/linux/man-pages/man3/getdelim.3.html"><code class="highlighter-rouge">getline</code></a>. However, this is deemed unsafe for some complier, and you might want to react to some specific character input. For example, reading the upper arrow char and pull up the last command typed.(I didn’t implement this bit, but feel free to try it out for yourself) In all, reading the line seems pretty trivial, so we won’t spend too much time on this.<h3 id="parser">Parser</h3><p>Personally, I feel like this is the most disturbing part of shell implementation. The goal is break the input line by spaces, and put the pieces in an array, terminated by a <code class="highlighter-rouge">NULL</code>. This is to make the execution easier, which we will get into in a bit.<p>So how might you do this? There is no library method like <code class="highlighter-rouge">split(' ')</code> like in Java. Luckily, there e is still something that can help: <a href="https://www.tutorialspoint.com/c_standard_library/c_function_strtok.htm"><code class="highlighter-rouge">strtok</code></a>. Basically, it takes a string and a delimiter, and splits the string into a bunch of tokens. What you need to be aware of is that the API isn’t as concise as in Java, and you will need to put a while loop for this to work(like the one in the link I put above). But with this, we should be able to at least split the command line into command tokens:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">**</span> <span class="nf">parseLine</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">line</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">demin</span><span class="p">,</span> <span class="kt">int</span> <span class="n">default_length</span><span class="p">)</span> <span class="p">{</span>
<span class="kt">char</span> <span class="o">**</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">*</span> <span class="n">default_length</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">tokenCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span> <span class="n">token</span><span class="p">;</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">demin</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="n">token</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="o">*</span><span class="p">(</span><span class="n">tokens</span> <span class="o">+</span> <span class="n">tokenCount</span><span class="p">)</span> <span class="o">=</span> <span class="n">token</span><span class="p">;</span>
<span class="n">tokenCount</span><span class="o">++</span><span class="p">;</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">demin</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">*</span><span class="p">(</span><span class="n">tokens</span> <span class="o">+</span> <span class="n">tokenCount</span><span class="p">)</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="k">return</span> <span class="n">tokens</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Since we are only implementing the simplest bit of shell, this would suffice. But in a shell like bash, you need special parsing for I/O redirection, echo command, and so on. Some of these are implemented in my code for you o have a look.<h3 id="executor">Executor</h3><p>So finally we set up everything, now we just need to execute it. However, there is a logic to exec the command that might you need think about for a bit to understand, so I want to talk about it first: fork/exec model.<p>The first thing you need to realise is that we cannot ‘just exec’ the command. Because if we do, when the command is executed, the OS will close this process, which means your shell can only execute one command, and then it exits. The way to solve this <code class="highlighter-rouge">fork()</code>, which makes a new process almost identical to the current process(apart from a different process id). This newly created process is called the ‘child’, and original process is called ‘parent’. Then we will <code class="highlighter-rouge">exec()</code> the command on the child process, and have the parent process <code class="highlighter-rouge">wait()</code> for it to finish.<p>So we have this new ‘child’ process to execute, but we still don’t know how to execute it. Luckily the C library has a collection of functions for it, each with different parameters. For simplicity I recommend <a href="https://linux.die.net/man/3/execvp"><code class="highlighter-rouge">execvp()</code></a>, which will search through your <code class="highlighter-rouge">PATH</code> and find the binary for you.<p>To give an example for using this, if your type in <code class="highlighter-rouge">ls -l</code>, the parser will produces a command token array like:<p><code class="highlighter-rouge">char *args[] = ['ls', '-l', NULL];</code><p>Then to execute this command, in your child process you will say<p><code class="highlighter-rouge">execvp(args[0], args);</code><p>If this executes and terminates, the parent will get the exit status, and proceed to finish the whole lifecycle for this command line.<p>Putting together the fork/exec model:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pid_t</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">getpid</span><span class="p">();</span>
<span class="n">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
<span class="c1">// error, failed to fork()
</span><span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// Parent process
</span><span class="p">{</span>
<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
<span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="c1">// Child process
</span><span class="p">{</span>
<span class="c1">// we are the child
</span><span class="n">execvp</span><span class="p">(...);</span>
<span class="n">_exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span> <span class="c1">// exec never returns
</span><span class="p">}</span>
</code></pre></div></div><p>Again you will see the full code later, I won’t paste the entire section here.<h3 id="conclusion">Conclusion</h3><p>So by this point, hopefully you understand what a simple command line goes through to get executed. Again, I am only scratching the surfaces here. In reality you need to implement a lot more than this. But it is quite fun to go into low-level C code and play with the OS personally, and I hope you can try it out some time.<h3 id="references">References</h3><p>My implementation of code can be found on my <a href="https://github.com/NickWu007/thsh">GitHub</a>. If you are doing a similar project and come across this post, I recommend you only read the post and not look at the actual implementation. First of all, what I write might not be fully correct, and you should always write your own code.<p>Also a shoutout for Stephen Brennan’s <a href="https://brennan.io/2015/01/16/write-a-shell-in-c/">post</a>. I learnt a lot from this post when I was working on the project, and probably he gives a better explanation about the exec model. So definitely check it out.<p>Hope you have a great weekend, and I will see you next week.<p>Nick Wu</article><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = 'https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/'; this.page.identifier = 'https://nickwu007.github.io/technical/2016/10/01/write-your-own-shell/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://devpractical.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><hr class="dingbat related" /><aside class="related mb4" role="complementary"><h2 class="hr">Related Posts</h2><ul class="related-posts"><li> <a href="/dart/technical/2018/03/29/teamoji-wrap-up-connecting-firebase-database/" class="h4 flip-title"> <span>Teamoji wrap-up: connecting Firebase database</span> </a> <time class="heading faded fine" datetime="2018-03-29T11:37:00+01:00">29 Mar 2018</time><li> <a href="/dart/technical/2018/03/19/teamoji-9-entering-firebase/" class="h4 flip-title"> <span>Teamoji #9 Entering Firebase</span> </a> <time class="heading faded fine" datetime="2018-03-19T22:21:00+00:00">19 Mar 2018</time><li> <a href="/dart/technical/2018/01/08/dart-8-homepage-part-2/" class="h4 flip-title"> <span>Dart #8: homepage part 2</span> </a> <time class="heading faded fine" datetime="2018-01-08T03:32:35+00:00">08 Jan 2018</time></ul></aside><aside class="comments related" role="complementary"><h2 class="hr">Comments</h2><div id="disqus_thread"></div><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></aside><footer role="contentinfo"><hr/><p><small class="copyright">© 2018. All rights reserved. </small><p><small>Powered by <a class="external" href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">7.5.1</span></small><hr class="sr-only"/></footer></main><hy-drawer><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:#48ea4e;background-image:url(/assets/images/sidebar.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"><h2 class="h1"><a href="/">DevPractical</a></h2><p class=""> Made by Nick Wu</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_navigation" href="/category/dart/" class="sidebar-nav-item" > Dart </a><li> <a href="/category/technical/" class="sidebar-nav-item" > Technical </a><li> <a href="/category/non-technical/" class="sidebar-nav-item" > Non-Technical </a><li> <a href="/category/life/" class="sidebar-nav-item" > Life </a><li> <a href="/about/" class="sidebar-nav-item" > About Me </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social</span><ul><li> <a href="https://twitter.com/WujunaoNick" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/NickWu007" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:wujunao19950715@gmail.com" title="email" class="no-mark-external"> <span class="icon-link"></span> <span class="sr-only">email</span> </a></ul></div></div></header></hy-drawer> </hy-push-state> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack-7.5.1.js');</script> <!--<![endif]--><hr class="sr-only"/><h2 class="sr-only">Templates:</h2><template id="_animation-template"><div class="animation-main fixed-top"><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading: <a class="this-link" href=""></a>.</div></template> <template id="_back-template"> <a id="_back" class="back nav-btn no-hover"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </a> </template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106129727-2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-106129727-2'); </script></html>
